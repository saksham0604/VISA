(function () {
    if (typeof window.CustomEvent === 'function') return false;
    function CustomEvent(event, params) {
        params = params || { bubbles: false, cancelable: false, detail: null };
        var evt = document.createEvent('CustomEvent');
        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
        return evt;
    }
    CustomEvent.prototype = window.Event.prototype;
    window.CustomEvent = CustomEvent;
})();

// Hero Marquee Tracking Events 
$(document).on('click', '.vs-hero-marquee-v2 a.vs-btn,.vs-hero-marquee-v2 a.vs-link-cta', function (e) {
    trackHeroMarqueeCTA(heroMarqueeHeaderText(this), this.text.trim(), this.pathname);
    e.stopPropagation();
});

$(document).on('click', '.vs-hero-marquee-v2 .vs-hero-pause-btn', function (e) {
    trackHeroMarqueePausePlay(heroMarqueeHeaderText(this), 'pause');
    e.stopPropagation();
});

$(document).on('click', '.vs-hero-marquee-v2 .vs-hero-play-btn', function (e) {
    trackHeroMarqueePausePlay(heroMarqueeHeaderText(this), 'play');
    e.stopPropagation();
});

// Brand Blade Container Tracking Events
$(document).on('click', '.brand-blade-container .vs-btn', function (e) {
    var headerText = $(this).closest('[data-gtm-card-title]').find('.vs-display-1').text();
    var visaLogoText = $(this).closest('[data-gtm-card-title]').find('.vs-display-1').find('.vs-sr-only').text();
    var linkText = $(this).text();
    var href = $(this).attr('href');
    brandbladeLinkClick(headerText, linkText, href,visaLogoText);
    e.stopPropagation();
});

$(document).on('click', '.vs-card-content', function () {
    var bundlebElement =  $(this).closest('.bundleb');
    if(bundlebElement.length > 0){
        var headerText = $(bundlebElement).find('.vs-lead').text();
        var href = $(this).attr('href');

        ctaTileTracking(headerText, href);
    }
});

// ECT Tracking Events
$(document).on('click', '.vs-ect a.vs-link-cta', function (e) {
    var ectElement = $(this).closest('div.vs-ect');
    if(ectElement.length > 0){
        var headerText = $(this).closest('.vs-ect').find('h2, h3, h4').text();
        var title = $(this).text();
        var href = $(this).attr('href');
        var containerType = $(this).closest('[data-container-type]').attr('data-container-type');
        if (containerType && containerType == 'tilecontainer') {
            containerType = 'container';
        }
        ectLinkClick(headerText, title, href, containerType);
        e.stopPropagation();
    }
});

// SCT Tracking Events
$(document).on('click', '.tile-container .vs-sct', function(e) {
    var title = $(this).find('.vs-ct-head p').text();
    var href = $(this).attr('href');
    sctTracking(title, href);  
    e.stopPropagation();
});


const pnsCustomEvent = 'track_pns_link';

function commonTrackingDetails(event, component_type) {
    const trackingDetails = {
        'event': event,
        'component_type': component_type
    }
    return trackingDetails
}


function heroMarqueeHeaderText(el) {
    return $($(el).parents('.vs-carousel-content').eq(0)).find('.vs-hero-marquee-header').text().trim();
}

function trackHeroMarqueeCTA(link_heading, link_text, link_url) {
    const e = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('hero-marquee-link-click', 'hero-marquee'),
            'link_heading': link_heading,
            'link_text': link_text,
            'link_url': link_url
        }
    })
    document.dispatchEvent(e)
}

function trackHeroMarqueePausePlay(link_heading, video_action) {
    const e = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('hero-marquee-video-click', 'hero-marquee'),
            'link_heading': link_heading,
            'video_action': video_action
        }
    })
    document.dispatchEvent(e)
}

function brandbladeLinkClick(headerText, linkText, url,visaLogoText) {
    if(visaLogoText != '' && headerText){
        headerText = 'visa ' + headerText.trim().substring(4).trim();
    }
    var headerTxt = headerText.trim();
    var linktxt = linkText.trim();
    const link_click_event = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('brandblade-link-click', 'brand-blade'),
            'link_heading': headerTxt,
            'link_text': linktxt,
            'link_url': url
        }
    });
    document.dispatchEvent(link_click_event);
}

function ectLinkClick(headerText, linkText, url, containerType) {
    var headerTxt = headerText.trim();
    var linkTxt = linkText.trim();
    const link_click_event = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('ect-link-click', 'ect'),
            'link_heading': headerTxt,
            'link_text': linkTxt,
            'link_url': url,
            'container_type': containerType
        }
    });
    document.dispatchEvent(link_click_event);
}

function sctTracking(title, url) {
    const sct_click_event = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('sct-link-click', 'sct'),
            'link_heading': title,
            'link_url': url
        }
    });
    document.dispatchEvent(sct_click_event);
}

function ctaTileTracking(headerText, url) {
    var headerTxt = headerText.trim();
    var cta_link_click_event = new CustomEvent(pnsCustomEvent, {
        detail: {
            ...commonTrackingDetails('brandbladebundleb-link-click', 'brand-blade-bundleb'),
            'link_heading': headerTxt,
            'link_url': url
        }
    });
    document.dispatchEvent(cta_link_click_event);
}

var utag_data = {
  country : "",
  action : "",
  page_url : "",
  pageType : "",
  region : "",
  subRegion : "",
  leadGen : "",
  leadGenIdentity : "",
  editorialType: "",
  language : "",
  formName : "",
  cName : "", 
  topic : "",
  business_Priority  : "",
  primary_tag : "",
  audiences:"",
  page_Type_and_Content : "",
  userMotivation : "" 
};
if(typeof(utag) === "undefined") {
	$(document).ready(
		function (a, b, c, d) {
			var tealiumRegionCode = encodeURI($(".tealiumRegionCode").val());
			var tealiumEnvCode = encodeURI($(".tealiumEnvCode").val());
			a = window.location.protocol + '//tags.tiqcdn.com/utag/visa/'
					+ tealiumRegionCode + '/' + tealiumEnvCode + '/utag.js';
			b = document;
			c = 'script';
			d = b.createElement(c);
			d.src = a;
			d.type = 'text/java' + c;
			d.async = true;
			a = b.getElementsByTagName(c)[0];
			a.parentNode.insertBefore(d, a)
		});
}

